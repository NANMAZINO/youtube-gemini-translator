# ğŸ›  YouTube AI Translator (Technical Documentation)

> **Gemini 3 Flash ê¸°ë°˜ YouTube ìë§‰ ë¬¸ë§¥ ë²ˆì—­ í”„ë¡œì íŠ¸**  
> ì¼ë°˜ ì‚¬ìš©ìë¥¼ ìœ„í•œ ì•ˆë‚´ëŠ” [ì‚¬ìš©ì ê°€ì´ë“œ](../README.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

---

## âœ¨ í•µì‹¬ ê¸°ëŠ¥ (Technical Features)

- **ë¬¸ë§¥ ì£¼ì… (Context Injection):** ì´ì „ ë²ˆì—­ ê²°ê³¼(History)ë¥¼ ë‹¤ìŒ ì²­í¬ ë²ˆì—­ ì‹œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— í¬í•¨í•˜ì—¬ ì¼ê´€ì„± ìœ ì§€.
- **ìŠ¤íŠ¸ë¦¬ë° íŒŒì‹± (Streaming UI):** `fetch` APIì˜ ReadableStreamì„ ì‚¬ìš©í•˜ì—¬ AI ì‘ë‹µ ìˆ˜ì‹  ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸.
- **ë¹„ì •í˜• ë°ì´í„° ìŠ¤íŠ¸ëŸ­ì²˜ë§:** Gemini JSON Modeë¥¼ í™œìš©í•˜ì—¬ íƒ€ì„ìŠ¤íƒ¬í”„ì™€ í…ìŠ¤íŠ¸ ìŒì„ ì •ë°€í•˜ê²Œ ì¶”ì¶œ.
- **íƒœìŠ¤í¬ í”„ë¦¬ì— ì…˜ (Task Preemption):** AbortController ë° ì˜ìƒ ID ë³€ê²½ ê°ì§€ë¥¼ í†µí•´ ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ì¦‰ì‹œ ì¤‘ë‹¨.
- **ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì‹œë„:** 429(Rate Limit), 503(Overload) ì—ëŸ¬ ë°œìƒ ì‹œ ê°€ì¤‘ì¹˜ë¥¼ ë‘” ì¬ì‹œë„ ë¡œì§ (`retry.js`).
- **ì¸ë©”ëª¨ë¦¬ & ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ìºì‹œ:** LRU ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜ 100ê°œ ì œí•œ, 30ì¼ TTL ìë™ ë§Œë£Œ ì‹œìŠ¤í…œ.

---

## ğŸ—‚ íŒŒì¼ êµ¬ì¡°

```
extension/
â”œâ”€â”€ manifest.json                 # Manifest V3 ì„¤ì • (v2.0.0)
â”œâ”€â”€ background.js                 # Service Worker â€” ë©”ì‹œì§€ ë¼ìš°íŒ…, ë²ˆì—­/ì¬ë¶„í•  ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜, íƒœìŠ¤í¬ í”„ë¦¬ì— ì…˜
â”œâ”€â”€ content.js                    # ESM ë™ì  import ë¡œë” (content/main.js ì§„ì…ì )
â”œâ”€â”€ content.css                   # ë²„íŠ¼Â·ì•Œë¦¼ ë“± ì½˜í…ì¸  ìŠ¤íƒ€ì¼ (ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ â†’ CSS í´ë˜ìŠ¤ ì „í™˜)
â”œâ”€â”€ icons/
â”‚   â””â”€â”€ icon.svg                  # í™•ì¥ í”„ë¡œê·¸ë¨ ì•„ì´ì½˜ (SVG)
â”œâ”€â”€ lib/                          # ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ constants.js              # ì „ì—­ ìƒìˆ˜ (API URL, ì…€ë ‰í„°, UI/ìºì‹œ/ì¬ì‹œë„/ì§„í–‰ë¥  ì„¤ì •ê°’)
â”‚   â”œâ”€â”€ errors.js                 # API ì—ëŸ¬ ë¶„ë¥˜ (429/503â†’ì¬ì‹œë„, 403â†’ê¶Œí•œ) ë° ì¬ì‹œë„ íŒë³„
â”‚   â”œâ”€â”€ logger.js                 # ëª¨ë“ˆ íƒœê·¸ + ë ˆë²¨ ê¸°ë°˜ êµ¬ì¡°í™” ë¡œê±°
â”‚   â”œâ”€â”€ retry.js                  # ê³µí†µ ì¬ì‹œë„ ìœ í‹¸ë¦¬í‹° â€” ì§€ìˆ˜ ë°±ì˜¤í”„ + ì¡°ê±´ë¶€ ì¬ì‹œë„
â”‚   â”œâ”€â”€ gemini.js                 # Gemini 3 Flash ë²ˆì—­ API í†µì‹  (ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ + JSON ìŠ¤í‚¤ë§ˆ)
â”‚   â”œâ”€â”€ gemini-refiner.js         # ë²ˆì—­ë³¸ ì •ë°€ ì¬ë¶„í• (Alignment) API â€” íƒ€ì„ë¼ì¸ ìµœì í™”
â”‚   â”œâ”€â”€ cache.js                  # ì¸ë±ìŠ¤/ë°ì´í„° ë¶„ë¦¬ ìºì‹œ (30ì¼ TTL, 100ê°œ LRU, ìë™ ë§Œë£Œ)
â”‚   â””â”€â”€ storage.js                # API Key ë‚œë…í™”(XOR+Base64) ì €ì¥ Â· í† í° ì‚¬ìš©ëŸ‰ íˆìŠ¤í† ë¦¬
â”œâ”€â”€ content/                      # ê¸°ëŠ¥ë³„ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸ (ë‹¨ì¼ ì±…ì„ ëª¨ë“ˆ ë¶„ë¦¬)
â”‚   â”œâ”€â”€ main.js                   # ì—”íŠ¸ë¦¬ â€” ëª¨ë“ˆ ì¡°ë¦½, Observer ê°ì‹œ, í˜ì´ì§€ ë‚´ë¹„ê²Œì´ì…˜ ì²˜ë¦¬
â”‚   â”œâ”€â”€ button-injector.js        # í”Œë¡œíŒ… ë²„íŠ¼Â·ë²ˆì—­Â·ì¬ë¶„í• Â·í† ê¸€ ë²„íŠ¼ ì£¼ì…
â”‚   â”œâ”€â”€ translation-flow.js       # ë²ˆì—­ ì‹¤í–‰Â·ìŠ¤íŠ¸ë¦¬ë° ìˆ˜ì‹ Â·ì§„í–‰ë¥  UIÂ·ì¬ë¶„í•  ê³µì •
â”‚   â”œâ”€â”€ panel-controller.js       # AI íŒ¨ë„ í† ê¸€/ì—´ê¸°Â·ìºì‹œ ìë™ ë³µì›Â·ë²„íŠ¼ ìƒíƒœ ë™ê¸°í™”
â”‚   â”œâ”€â”€ message-handler.js        # íŒì—… â†” ì½˜í…ì¸  chrome.runtime ë©”ì‹œì§€ ë¼ìš°íŒ…
â”‚   â”œâ”€â”€ shared-actions.js         # ëª¨ë“ˆ ê°„ ê²½ëŸ‰ ì•¡ì…˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ (window ì „ì—­ ì˜¤ì—¼ ì œê±°)
â”‚   â”œâ”€â”€ ui.js                     # Shadow DOM UI â€” ì‚¬ì´ë“œë°”Â·ì˜¤ë²„ë ˆì´Â·ì‹œê°„ ë™ê¸°í™”Â·ë“œë˜ê·¸Â·ì•Œë¦¼
â”‚   â”œâ”€â”€ captions.js               # ìë§‰ ì¶”ì¶œ + ë¬¸ì¥ ê²½ê³„ ê·¸ë£¹í™” + í† í° ê¸°ë°˜ ì²­í¬ ë¶„í• 
â”‚   â”œâ”€â”€ transcript-opener.js      # MutationObserver ê¸°ë°˜ ìë§‰ íŒ¨ë„ ìë™ ì˜¤í”ˆ
â”‚   â””â”€â”€ utils.js                  # íƒ€ì„ìŠ¤íƒ¬í”„ íŒŒì‹± Â· CJK ê°€ì¤‘ í† í° ì¶”ì • Â· ì˜ìƒ ID ì¶”ì¶œ
â””â”€â”€ popup/                        # í™•ì¥ í”„ë¡œê·¸ë¨ íŒì—… UI
    â”œâ”€â”€ popup.html                # íŒì—… ë§ˆí¬ì—… (API KeyÂ·ì„¤ì •Â·ìºì‹œÂ·í† í° ì‚¬ìš©ëŸ‰)
    â”œâ”€â”€ popup.js                  # íŒì—… ë¡œì§ (ì„¤ì • ì €ì¥/ë¡œë“œ, ìºì‹œ ê´€ë¦¬, ë¹„ìš© ê³„ì‚°)
    â””â”€â”€ popup.css                 # íŒì—… ìŠ¤íƒ€ì¼ (ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜)
```

---

## ğŸ— ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YouTube Page (Content Scripts)                              â”‚
â”‚                                                              â”‚
â”‚  content.js â”€â”€â–º main.js (ì—”íŠ¸ë¦¬ Â· ëª¨ë“ˆ ì¡°ë¦½)                 â”‚
â”‚                  â”œâ”€ button-injector.js   ë²„íŠ¼ ì£¼ì…            â”‚
â”‚                  â”œâ”€ translation-flow.js  ë²ˆì—­ ì‹¤í–‰Â·ìŠ¤íŠ¸ë¦¬ë°   â”‚
â”‚                  â”œâ”€ panel-controller.js  íŒ¨ë„ í† ê¸€Â·ìƒíƒœ ê´€ë¦¬  â”‚
â”‚                  â”œâ”€ message-handler.js   ë©”ì‹œì§€ ë¼ìš°íŒ…        â”‚
â”‚                  â”œâ”€ shared-actions.js    ëª¨ë“ˆ ê°„ ì•¡ì…˜ ê³µìœ     â”‚
â”‚                  â”œâ”€ ui.js               Shadow DOM ë Œë”ë§    â”‚
â”‚                  â”œâ”€ captions.js          ìë§‰ ì¶”ì¶œ + ì²­í¬í™”  â”‚
â”‚                  â”œâ”€ transcript-opener.js íŒ¨ë„ ìë™ ì˜¤í”ˆ       â”‚
â”‚                  â””â”€ utils.js            ìœ í‹¸ë¦¬í‹°              â”‚
â”‚                                                              â”‚
â”‚  chrome.runtime.sendMessage()                                â”‚
â”‚          â–¼                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Background Service Worker                                   â”‚
â”‚                                                              â”‚
â”‚  background.js â”€â”€ handleTranslation / handleRefine           â”‚
â”‚                    â”œâ”€ gemini.js          ë²ˆì—­ API í˜¸ì¶œ       â”‚
â”‚                    â”œâ”€ gemini-refiner.js  ì¬ë¶„í•  API í˜¸ì¶œ     â”‚
â”‚                    â”œâ”€ retry.js           ê³µí†µ ì¬ì‹œë„ ìœ í‹¸    â”‚
â”‚                    â”œâ”€ storage.js         í‚¤ ê´€ë¦¬ + í† í°      â”‚
â”‚                    â””â”€ errors.js          ì—ëŸ¬ ë¶„ë¥˜           â”‚
â”‚                                                              â”‚
â”‚  chrome.tabs.sendMessage() (ìŠ¤íŠ¸ë¦¬ë° ê²°ê³¼ í‘¸ì‹œ)              â”‚
â”‚          â–¼                                                   â”‚
â”‚  Content Script â†’ UI ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Popup                                                       â”‚
â”‚  popup.html/js/css â”€â”€ API Key ì €ì¥, ì„¤ì •, ìºì‹œ ê´€ë¦¬          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

| ì˜ì—­        | ê¸°ìˆ                                                                     |
| ----------- | ----------------------------------------------------------------------- |
| í”Œë«í¼      | Chrome Extension **Manifest V3** (Service Worker ê¸°ë°˜)                  |
| AI ëª¨ë¸     | **Gemini 3 Flash Preview** (`generativelanguage.googleapis.com/v1beta`) |
| UI ê²©ë¦¬     | **Shadow DOM** â€” YouTube í˜¸ìŠ¤íŠ¸ í˜ì´ì§€ì™€ ì™„ì „ ê²©ë¦¬                      |
| DOM ê°ì§€    | **MutationObserver** â€” íŒ¨ë„ ë“±ì¥Â·í˜ì´ì§€ ë³€ê²½ ê°ì§€ (í´ë§ ì œê±°)           |
| ëª¨ë“ˆ íŒ¨í„´   | **Factory Function** + DI â€” ë‹¨ì¼ ì±…ì„ ë¶„ë¦¬, `window` ì „ì—­ ì˜¤ì—¼ ì œê±°     |
| ì—ëŸ¬ í•¸ë“¤ë§ | **ê³µí†µ ì¬ì‹œë„ ìœ í‹¸** (`retry.js`) â€” ì§€ìˆ˜ ë°±ì˜¤í”„ + ì¡°ê±´ë¶€ ì¬ì‹œë„         |
| ë³´ì•ˆ        | **XOR + Base64** â€” API Key ë‚œë…í™” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë³´í˜¸                    |
| ì–¸ì–´        | **Vanilla JavaScript (ES Modules)** â€” í”„ë ˆì„ì›Œí¬ ì˜ì¡´ ì—†ìŒ              |

---

## ğŸ§ª í…ŒìŠ¤íŠ¸

Node ë‚´ì¥ í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ ê¸°ë°˜ ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤

```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm test

# ì»¤ë²„ë¦¬ì§€ í¬í•¨ ì‹¤í–‰
npm run test:coverage
```

| í…ŒìŠ¤íŠ¸ íŒŒì¼             | ëŒ€ìƒ ëª¨ë“ˆ                         |
| ----------------------- | --------------------------------- |
| `lib/retry.test.js`     | `retry.js` â€” ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì‹œë„   |
| `lib/errors.test.js`    | `errors.js` â€” API ì—ëŸ¬ ë¶„ë¥˜       |
| `content/utils.test.js` | `utils.js` â€” íƒ€ì„ìŠ¤íƒ¬í”„Â·í† í° ì¶”ì • |

- ì»¤ë²„ë¦¬ì§€ ì„ê³„ê°’: line / function / branch ìµœì†Œ 80%
