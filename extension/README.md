# ğŸ›  YouTube AI Translator (Technical Documentation)

> **Gemini 3 Flash Preview ê¸°ë°˜ YouTube ìë§‰ ë¬¸ë§¥ ë²ˆì—­ í”„ë¡œì íŠ¸**  
> ì¼ë°˜ ì‚¬ìš©ìë¥¼ ìœ„í•œ ì•ˆë‚´ëŠ” [ì‚¬ìš©ì ê°€ì´ë“œ](../README.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

---

## âœ¨ í•µì‹¬ ê¸°ëŠ¥ (Technical Features)

- **ë¬¸ë§¥ ì£¼ì… (Context Injection):** ì´ì „ ë²ˆì—­ ê²°ê³¼(History)ë¥¼ ë‹¤ìŒ ì²­í¬ ë²ˆì—­ ì‹œ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— í¬í•¨í•´ í†¤/ìš©ì–´ ì¼ê´€ì„± ìœ ì§€.
- **ìŠ¤íŠ¸ë¦¬ë° UI (Streaming UI):** `fetch` + ReadableStream ê¸°ë°˜ ì‘ë‹µì„ ë°›ì•„ UIë¥¼ ì¦‰ì‹œ ì—…ë°ì´íŠ¸.
- **êµ¬ì¡°í™” ì‘ë‹µ (JSON Mode):** Gemini JSON Mode + JSON Schemaë¡œ íƒ€ì„ìŠ¤íƒ¬í”„/í…ìŠ¤íŠ¸ ìŒì„ ì•ˆì •ì ìœ¼ë¡œ íŒŒì‹±.
- **ë¶€ë¶„ ì €ì¥ & ì´ì–´ë°›ê¸° (Resume Mode):** ë²ˆì—­ ì§„í–‰ ì¤‘ ì²­í¬ ë‹¨ìœ„ë¡œ **ë¶€ë¶„ ìºì‹œ ìŠ¤ëƒ…ìƒ·**ì„ ì €ì¥í•˜ê³ , ì¤‘ë‹¨ í›„ fingerprint/ì²´í¬í¬ì¸íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ì¬ê°œ ì§€ì ì„ ê³„ì‚°í•´ ë¹„ìš©Â·ì‹œê°„ ì ˆê°.
- **íƒœìŠ¤í¬ í”„ë¦¬ì— ì…˜ (Task Preemption):** AbortController + íƒ­/URL/ì˜ìƒ ID ë³€ê²½ ê°ì§€ë¡œ ë¶ˆí•„ìš”í•œ API í˜¸ì¶œì„ ì¦‰ì‹œ ì¤‘ë‹¨.
- **ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì‹œë„:** 429/503(overloaded) ë“± ì¬ì‹œë„ ê°€ëŠ¥ ì—ëŸ¬ì— ëŒ€í•´ ê³µí†µ ì¬ì‹œë„ ìœ í‹¸(`retry.js`) ì ìš©.
- **ì¸ë©”ëª¨ë¦¬ & ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ìºì‹œ:** LRU(ìµœëŒ€ 100ê°œ) + TTL(30ì¼) ìë™ ë§Œë£Œ. íŒì—…ì—ì„œ ê´€ë¦¬(ëª©ë¡/ê°œë³„ì‚­ì œ/ì „ì²´ì‚­ì œ).
- **í† í° ì‚¬ìš©ëŸ‰ ê¸°ë¡:** ì¼/30ì¼ ê¸°ì¤€ ì…ë ¥Â·ì¶œë ¥ í† í° íˆìŠ¤í† ë¦¬ë¥¼ ì €ì¥í•˜ê³  íŒì—…ì—ì„œ ì¶”ì • ë¹„ìš© í‘œì‹œ.

---

## ğŸ—‚ íŒŒì¼ êµ¬ì¡°

```
extension/
â”œâ”€â”€ manifest.json                 # Manifest V3 (v2.1.1)
â”œâ”€â”€ background.js                 # Service Worker: ë²ˆì—­/ì¬ë¶„í•  ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜, íƒœìŠ¤í¬ ì¤‘ë‹¨/ì¬ì‹œë„
â”œâ”€â”€ content.js                    # ESM ë¡œë” (content/main.js ì§„ì…)
â”œâ”€â”€ content.css                   # ì½˜í…ì¸ /ë²„íŠ¼ ìŠ¤íƒ€ì¼
â”œâ”€â”€ icons/
â”‚   â””â”€â”€ icon.svg
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ constants.js              # ì „ì—­ ìƒìˆ˜ (API URL, ì…€ë ‰í„°, UI/ìºì‹œ/ì¬ì‹œë„ ì„¤ì •)
â”‚   â”œâ”€â”€ gemini.js                 # Gemini ë²ˆì—­ API (JSON Schema ì‘ë‹µ)
â”‚   â”œâ”€â”€ gemini-refiner.js         # ì¬ë¶„í• (Alignment) API
â”‚   â”œâ”€â”€ retry.js                  # ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì‹œë„ ìœ í‹¸
â”‚   â”œâ”€â”€ errors.js                 # API ì—ëŸ¬ ë¶„ë¥˜ (MODEL_OVERLOADED/QUOTA_EXCEEDED ë“±)
â”‚   â”œâ”€â”€ cache.js                  # ìºì‹œ (30ì¼ TTL, 100ê°œ LRU, ë¶€ë¶„ ì €ì¥)
â”‚   â”œâ”€â”€ storage.js                # API Key ë‚œë…í™” ì €ì¥, í† í° íˆìŠ¤í† ë¦¬
â”‚   â”œâ”€â”€ logger.js                 # ëª¨ë“ˆ íƒœê·¸ + ë ˆë²¨ ë¡œê¹…
â”‚   â”œâ”€â”€ cache.test.js
â”‚   â”œâ”€â”€ errors.test.js
â”‚   â””â”€â”€ retry.test.js
â”œâ”€â”€ content/
â”‚   â”œâ”€â”€ main.js                   # ì—”íŠ¸ë¦¬: Observer/ë„¤ë¹„ê²Œì´ì…˜ ì²˜ë¦¬, ëª¨ë“ˆ ì¡°ë¦½
â”‚   â”œâ”€â”€ translation-flow.js       # ë²ˆì—­/ì´ì–´ë°›ê¸°/ë¶€ë¶„ì €ì¥/ì¬ì‹œë„/ì¬ë¶„í•  í”Œë¡œìš°
â”‚   â”œâ”€â”€ panel-controller.js       # íŒ¨ë„ ì—´ê¸°/í† ê¸€ + ìºì‹œ ë Œë”
â”‚   â”œâ”€â”€ button-injector.js        # "ğŸ“œ ìŠ¤í¬ë¦½íŠ¸ ì—´ê¸°", "ğŸ¤– AI ë²ˆì—­", "ì¬ë¶„í• ", íŒ¨ë„ í† ê¸€ ì£¼ì…
â”‚   â”œâ”€â”€ captions.js               # ìë§‰ ì¶”ì¶œ/ê°€ê³µ
â”‚   â”œâ”€â”€ transcript-opener.js      # ìœ íŠœë¸Œ ìŠ¤í¬ë¦½íŠ¸ íŒ¨ë„ ì˜¤í”ˆ
â”‚   â”œâ”€â”€ message-handler.js        # ë©”ì‹œì§€ ë¸Œë¦¿ì§€
â”‚   â”œâ”€â”€ ui.js                     # Shadow DOM UI/ì˜¤ë²„ë ˆì´, import/export, ì•Œë¦¼
â”‚   â”œâ”€â”€ utils.js
â”‚   â””â”€â”€ utils.test.js
â””â”€â”€ popup/
    â”œâ”€â”€ popup.html                # ì„¤ì •/í† í°/ìºì‹œ UI
    â”œâ”€â”€ popup.js                  # ì„¤ì • ì €ì¥, í† í°/ìºì‹œ ëª©ë¡ ë Œë”ë§
    â””â”€â”€ popup.css
```

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

| ì˜ì—­        | ê¸°ìˆ                                                                                                   |
| ----------- | ----------------------------------------------------------------------------------------------------- |
| í”Œë«í¼      | Chrome Extension **Manifest V3** (Service Worker ê¸°ë°˜)                                                |
| AI ëª¨ë¸     | **Gemini 3 Flash Preview** (`generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview`) |
| UI ê²©ë¦¬     | **Shadow DOM** â€” YouTube í˜¸ìŠ¤íŠ¸ í˜ì´ì§€ì™€ ê²©ë¦¬                                                         |
| DOM ê°ì§€    | **MutationObserver** â€” íŒ¨ë„ ë“±ì¥/í˜ì´ì§€ ì „í™˜ ê°ì§€                                                     |
| ëª¨ë“ˆ íŒ¨í„´   | **Factory Function** + DI â€” ë‹¨ì¼ ì±…ì„ ë¶„ë¦¬, ì „ì—­ ì˜¤ì—¼ ìµœì†Œí™”                                          |
| ì—ëŸ¬ í•¸ë“¤ë§ | ê³µí†µ ì¬ì‹œë„ ìœ í‹¸(`retry.js`) + ì—ëŸ¬ ë¶„ë¥˜(`errors.js`)                                                 |
| ë³´ì•ˆ        | **XOR + Base64** â€” API Key ë‚œë…í™” ë¡œì»¬ ì €ì¥                                                           |
| ì–¸ì–´        | Vanilla JavaScript (ES Modules)                                                                       |

---

## ğŸ§ª í…ŒìŠ¤íŠ¸

Node ë‚´ì¥ í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ ê¸°ë°˜ ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

```bash
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm test

# ì»¤ë²„ë¦¬ì§€ í¬í•¨ ì‹¤í–‰
npm run test:coverage
```

| í…ŒìŠ¤íŠ¸ íŒŒì¼             | ëŒ€ìƒ ëª¨ë“ˆ                                 |
| ----------------------- | ----------------------------------------- |
| `lib/cache.test.js`     | `cache.js` â€” ìºì‹œ(LRU/TTL/ì‚­ì œ/ë¶€ë¶„ ì €ì¥) |
| `lib/retry.test.js`     | `retry.js` â€” ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì‹œë„           |
| `lib/errors.test.js`    | `errors.js` â€” API ì—ëŸ¬ ë¶„ë¥˜               |
| `content/utils.test.js` | `utils.js` â€” íƒ€ì„ìŠ¤íƒ¬í”„/í† í° ì¶”ì • ë“±      |

- ì»¤ë²„ë¦¬ì§€ ì¸¡ì • ëŒ€ìƒì€ `package.json`ì˜ `test:coverage` ìŠ¤í¬ë¦½íŠ¸(`--test-coverage-include`) ê¸°ì¤€ì…ë‹ˆë‹¤.
- ì»¤ë²„ë¦¬ì§€ ì„ê³„ê°’: line / function / branch ìµœì†Œ 80%
