# 🤖 YouTube AI Translator

> Gemini 3 Flash 기반 YouTube 자막 **문맥 번역** Chrome 확장 프로그램

YouTube 영상의 자막(스크립트)을 Gemini AI가 문맥을 이해하며 번역하고,  
영상 위에 실시간 자막 오버레이로 보여줍니다

---

## ✨ 주요 기능

| 기능                 | 설명                                                     |
| -------------------- | -------------------------------------------------------- |
| **원클릭 번역**      | 버튼 한 번이면 자막 패널 오픈부터 번역까지 자동 진행     |
| **문맥 기반 번역**   | 단순 직역이 아닌, 앞뒤 맥락을 이해한 자연스러운 번역     |
| **실시간 자막 표시** | 번역된 자막이 영상 위에 타이밍에 맞춰 자동 표시          |
| **실시간 진행률**    | 번역 진행 퍼센트와 경과 시간을 실시간으로 확인           |
| **자동 재시도**      | 오류 발생 시 자동으로 다시 시도, 상태도 화면에 표시      |
| **번역 품질 조절**   | AI 사고 깊이를 4단계로 조절                              |
| **자막 재분할**      | 번역 결과가 길게 뭉쳐 있을 때, 보기 좋게 재배치          |
| **자동 저장**        | 한 번 번역한 영상은 자동 저장되어 다시 방문 시 바로 적용 |
| **다국어 지원**      | 한국어 · English · 日本語, 원본 언어 자동 감지           |
| **비용 확인**        | 사용한 토큰량과 예상 비용을 팝업에서 바로 확인           |

---

## 📋 사전 준비

### Gemini API Key 발급

1. **[Google AI Studio](https://aistudio.google.com/apikey)** 에 접속합니다
2. Google 계정으로 로그인합니다
3. **"Create API Key"** 버튼을 클릭합니다
4. 생성된 API Key를 복사해 둡니다

> [!NOTE]
> API Key는 XOR + Base64 난독화 처리 후 브라우저 로컬 스토리지에 저장되며, 외부 서버로 전송되지 않습니다  
> 무료 티어에서도 분당 요청 제한 내에서 사용 가능합니다

---

## 🚀 설치 방법

### 1. 소스 코드 다운로드

**방법 A — ZIP 다운로드**

1. GitHub 저장소 페이지에서 **Code → Download ZIP** 클릭
2. 다운로드된 ZIP 파일을 원하는 위치에 압축 해제

**방법 B — Git Clone**

```bash
git clone https://github.com/<your-repo>/yg-translator.git
```

### 2. Chrome에 확장 프로그램 등록

1. Chrome 주소창에 `chrome://extensions` 입력 후 이동 또는 "확장앱 관리" 이동
2. 우측 상단 **"개발자 모드"** 토글을 **ON**으로 변경
3. **"압축해제된 확장 프로그램을 로드합니다"** 버튼 클릭
4. 다운로드한 폴더 안의 **`extension`** 폴더를 선택
5. 확장 프로그램 목록에 **"YouTube AI Translator"** 가 나타나면 설치 완료

> [!TIP]
> Chrome 상단 퍼즐 아이콘(🧩)을 클릭 → YouTube AI Translator 옆 📌 핀 고정하면  
> 툴바에서 바로 접근할 수 있습니다

---

## 📖 사용 방법

### Step 1 — API Key 등록

1. Chrome 툴바에서 **확장 프로그램 아이콘**을 클릭하여 팝업을 엽니다
2. **Gemini API Key** 입력창에 복사해둔 API Key를 붙여넣기 합니다
3. **"저장"** 버튼을 클릭합니다

### Step 2 — 번역 실행

**방법 A — 원클릭 (권장)**

1. 번역할 YouTube 영상 페이지로 이동합니다
2. 좋아요, 공유 버튼 옆에 나타나는 **"🤖 AI 번역"** 버튼을 클릭합니다
3. 자막 패널이 **자동으로 열리고** 번역이 즉시 시작됩니다

**방법 B — 수동**

1. 영상 아래 **"...더보기"** → **"스크립트 표시"** 로 자막 패널을 엽니다
2. 자막 패널 상단의 **"🤖 AI 번역"** 버튼을 클릭합니다

> [!IMPORTANT]
> 자막이 없는 영상(자동 생성 자막도 없는 경우)은 번역할 수 없습니다

### Step 3 — 번역 진행

1. 번역이 청크 단위로 진행되며, **실시간 진행률(%)과 경과 시간**이 표시됩니다
2. API 오류 발생 시 **자동 재시도** 되며, 버튼에 재시도 상태가 표시됩니다
3. 번역된 자막이 **영상 위에 오버레이**로 실시간 표시됩니다
4. 완료 후 동일 영상 재방문 시 **캐시된 번역이 자동 적용**됩니다

### Step 3.5 — 자막 재분할 (선택)

AI 번역의 결과가 한 줄에 텍스트가 몰려 있어 가독성이 떨어질 수 있습니다  
**재분할** 기능은 이 문제를 보정합니다

1. 번역이 완료되면 **"🤖 AI 번역"** 버튼 옆에 **"재분할"** 버튼이 활성화됩니다
2. 클릭하면 Gemini가 번역문을 원본 타임스탬프에 맞춰 **정밀 재배치**합니다
3. 완료 시 캐시가 자동 업데이트되며, 다음 방문 시 재분할된 버전이 적용됩니다

> [!TIP]
> 한 줄에 텍스트가 몰려 보일 때 사용하면 효과적입니다  
> 이미 재분할된 캐시가 있으면 버튼이 **"✅ 재분할 완료"** 로 표시됩니다

### Step 4 — 설정 변경 (선택)

팝업에서 아래 옵션을 조정할 수 있습니다:

| 설정                 | 기본값    | 설명                                               |
| -------------------- | --------- | -------------------------------------------------- |
| **추론 레벨**        | Minimal   | Gemini의 사고 깊이 (Minimal → Low → Medium → High) |
| **원본 언어 (From)** | 자동 감지 | 원본 자막의 언어를 지정하거나 자동 감지            |
| **번역 언어 (To)**   | 한국어    | 번역 결과 언어 선택                                |

> [!TIP]
> 대부분의 영상은 추론 레벨 **Minimal**로 충분합니다
> 화자가 여러명일 경우 추론 레벨을 **Low** 이상으로 올리면 품질이 향상됩니다

---

## ⚠️ 제한사항

- 자막(Script) 데이터가 없는 영상은 번역할 수 없습니다
- 한 번에 하나의 영상만 번역 가능합니다
- Gemini API 무료 티어의 분당 요청 제한이 적용됩니다

---

## 💰 비용 안내

이 확장 프로그램은 Google의 **Gemini 3 Flash** 모델을 사용합니다

| 항목      | 단가              |
| --------- | ----------------- |
| 입력 토큰 | $0.50 / 1M tokens |
| 출력 토큰 | $3.00 / 1M tokens |

- 팝업의 **토큰 사용량** 섹션에서 일별 · 30일 누적 사용량 및 예상 비용을 확인할 수 있습니다
- 정확한 사용량은 [Google AI Studio](https://aistudio.google.com/)에서 확인하세요

---

## 🗂 파일 구조

```
extension/
├── manifest.json          # Chrome 확장 프로그램 설정 (Manifest V3)
├── background.js          # Gemini API 통신 및 메시지 라우팅
├── content.js             # 모듈 시스템 초기화 로더
├── content.css            # 기본 콘텐츠 스타일
├── icons/
│   └── icon.svg           # 확장 프로그램 아이콘
├── lib/                   # 공통 라이브러리 모듈
│   ├── constants.js       # 프로젝트 전역 상수 (URL, 셀렉터, 설정값)
│   ├── errors.js          # API 에러 분류 및 재시도 판별
│   ├── logger.js          # 모듈 태그 + 레벨 기반 구조화 로거
│   ├── gemini.js          # Gemini 3 Flash 번역 API 통신
│   ├── gemini-refiner.js  # 번역본 정밀 재분할(Alignment) 모듈
│   ├── cache.js           # 번역 캐시 관리 (30일 TTL / 100개 제한)
│   └── storage.js         # API Key 난독화 저장 · 토큰 사용량 관리
├── content/               # 기능별 콘텐츠 스크립트
│   ├── main.js            # 메인 컨트롤러 (패널 감지 · 원클릭 진입 · 진행도 UX)
│   ├── ui.js              # Shadow DOM 기반 UI 렌더링
│   ├── captions.js        # 자막 추출 및 전처리
│   ├── transcript-opener.js # 자막 패널 자동 오픈 모듈
│   └── utils.js           # 유틸리티 (CJK 토큰 추정 등)
└── popup/                 # 확장 프로그램 팝업 UI
    ├── popup.html
    ├── popup.js
    └── popup.css
```

---

## 🛠 기술 스택

- **Chrome Extension Manifest V3**
- **Gemini 3 Flash** (generativelanguage.googleapis.com)
- **Shadow DOM** — 호스트 페이지와 격리된 UI
- **MutationObserver** — 효율적인 DOM 변경 감지 (폴링 대체)
- **XOR + Base64** — API 키 난독화 스토리지 보호
- **Vanilla JavaScript** — 프레임워크 의존 없음
